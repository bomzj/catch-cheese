(function(t){function e(e){for(var a,s,o=e[0],c=e[1],l=e[2],h=0,d=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(a=!1)}a&&(i.splice(e--,1),t=s(s.s=n[0]))}return t}var a={},r={app:0},i=[];function s(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=a,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},1:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},"408c":function(t,e,n){"use strict";var a=n("7262"),r=n.n(a);r.a},5:function(t,e){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("h1",{staticClass:"text-center py-3"},[t._v("Catch the Cheese")]),n("div",{staticClass:"row"},[n("div",{staticClass:"col"},[n("GameStats",{attrs:{score:t.score,round:t.round}})],1)]),n("div",{staticClass:"row"},[n("div",{staticClass:"col"},[n("GameField",{attrs:{map:t.map}})],1)]),n("div",{staticClass:"row"},[n("div",{staticClass:"col"},[n("Trainer",{attrs:{agent:t.player}})],1)])])},i=[],s=(n("c975"),n("d81d"),n("96cf"),n("89ba")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"game-stats"},[n("span",{staticClass:"p-3"},[t._v("Game "+t._s(t.round))]),n("span",{staticClass:"p-3"},[t._v("Score "),n("transition",{attrs:{name:"pulse",mode:"out-in"}},[n("span",{key:t.score,staticClass:"score-value",class:t.scoreCssClass},[t._v(t._s(t.score))])])],1)])},c=[],l={name:"GameStats",props:["score","round"],computed:{scoreCssClass:function(){return this.score>=0?"text-success":"text-danger"}}},u=l,h=(n("408c"),n("2877")),d=Object(h["a"])(u,o,c,!1,null,null,null),p=d.exports,m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex py-3 game-grid"},t._l(t.map,(function(e){return n("div",{staticClass:"border border-right-0 game-grid-cell"},[t._v(t._s(e))])})),0)},f=[],g={name:"GameField",props:["map"]},b=g,v=(n("8d4b"),Object(h["a"])(b,m,f,!1,null,null,null)),y=v.exports,C=(n("d3b7"),n("9f12")),w=n("53fe"),x=n("284c"),O=n("2fa7"),j=n("0b53"),S=(n("dca8"),Object.freeze({PlayerChar:"🐭",CatChar:"🐱",CheeseChar:"🧀"})),M=function(){function t(){Object(C["a"])(this,t),Object(O["a"])(this,"game",null),Object(O["a"])(this,"model",null),Object(O["a"])(this,"exploration",.9),Object(O["a"])(this,"discount",.95),Object(O["a"])(this,"oldScore",0),Object(O["a"])(this,"oldAction",0),Object(O["a"])(this,"oldState",void 0),Object(O["a"])(this,"responseTime",300),Object(O["a"])(this,"memory",[]),Object(O["a"])(this,"isTraining",!1),Object(O["a"])(this,"isModelValidating",!1),Object(O["a"])(this,"winsInRow",0),this.buildModel()}return Object(w["a"])(t,[{key:"buildModel",value:function(){this.model=j["b"](),this.model.add(j["a"].dense({inputShape:1,units:2})),this.model.compile({optimizer:"sgd",loss:"meanSquaredError"})}},{key:"getState",value:function(){var t=this.game.map.indexOf(S.CheeseChar),e=this.game.map.indexOf(S.PlayerChar),n=e>t?-1:1;return j["c"]([n])}},{key:"act",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,n,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.isTraining){t.next=3;break}return t.next=3,this.handleTraining();case 3:if(this.exploration<Math.random()?(e=this.getState(),n=this.getBestAction(e)):n=Math.random()<.5?0:1,this.isTraining){t.next=7;break}return t.next=7,new Promise((function(t){setTimeout(t,a.responseTime)}));case 7:return t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleTraining",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.getState(),this.oldState&&this.memory.push({state:this.oldState,action:this.oldAction,reward:this.GetReward(),nextState:e,isFinished:this.oldScore!=this.game.score}),!this.isModelValidating){t.next=7;break}this.game.score>this.oldScore?this.winsInRow++:this.game.score<this.oldScore&&(this.isModelValidating=!1,this.winsInRow=0),20==this.winsInRow&&(this.isTraining=!1,this.isModelValidating=!1,this.memory=[],this.winsInRow=0),t.next=13;break;case 7:if(!(this.memory.length>=100)){t.next=13;break}return t.next=10,this.fitModel();case 10:this.isModelValidating=!0,this.memory=[],this.exploration=0;case 13:this.oldState=e,this.oldAction=this.getBestAction(e),this.oldScore=this.game.score;case 16:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getBestAction",value:function(t){t=this.getState();var e=this.model.predict(t).arraySync()[0],n=e.indexOf(Math.max.apply(Math,Object(x["a"])(e)));return n}},{key:"GetReward",value:function(){var t=0;return this.oldScore<this.game.score?t=100:this.oldScore>this.game.score&&(t=-100),t}},{key:"fitModel",value:function(){for(var t=[],e=[],n=0;n<this.memory.length;n++){var a=this.memory[n],r=a.state,i=a.action,s=a.reward,o=a.nextState,c=a.isFinished,l=s;if(!c){var u=this.model.predict(o).arraySync()[0];l=s+this.discount*Math.max.apply(Math,Object(x["a"])(u))}u=this.model.predict(r).arraySync()[0],u[i]=l,t.push(r.arraySync()[0]),e.push(u)}return t=j["c"](t),e=j["c"](e),this.model.fit(t,e,{epochs:100,batchSize:this.memory.length,shuffle:!0,callbacks:{onTrainEnd:console.log("training complete")}})}}]),t}(),T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"text-center p-2"},[n("button",{staticClass:"btn btn-success",attrs:{type:"button",disabled:t.agent.isTraining},on:{click:t.trainAgent}},[t._v(t._s(t.buttonTitle))])])},_=[],k={name:"Trainer",props:["agent"],computed:{buttonTitle:function(){var t="Train Agent";return this.agent.isTraining&&this.agent.isModelValidating?t="Validating...":this.agent.isTraining&&(t="Training..."),t}},methods:{trainAgent:function(){this.agent.isTraining=!0}}},P=k,R=Object(h["a"])(P,T,_,!1,null,null,null),A=R.exports,G={name:"app",components:{GameStats:p,GameField:y,Trainer:A},data:function(){return{mapLength:12,map:[],player:null,score:0,round:1}},created:function(){var t=new M;function e(){return n.apply(this,arguments)}function n(){return n=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.update();case 2:setTimeout(e.bind(this),0);case 3:case"end":return t.stop()}}),t,this)}))),n.apply(this,arguments)}this.setPlayer(t),e.call(this)},methods:{setPlayer:function(t){this.player=t,t.game=this,this.generateMap()},update:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,n,a,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.player.act();case 2:e=t.sent,n=this.map.indexOf(S.PlayerChar),a=n+(e||-1),r=this.map[a],i=this.score,r==S.CatChar?this.score--:r==S.CheeseChar&&this.score++,i==this.score?(this.$set(this.map,a,S.PlayerChar),this.$set(this.map,n,"")):(this.generateMap(),this.round++);case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),generateMap:function(){this.map=Array(this.mapLength),this.map[0]=Math.random()>.5?S.CatChar:S.CheeseChar,this.map[this.map.length-1]=this.map[0]==S.CatChar?S.CheeseChar:S.CatChar;var t=Math.floor(Math.random()*(this.mapLength-2))+1;this.map[t]=S.PlayerChar}}},V=G,$=Object(h["a"])(V,r,i,!1,null,null,null),E=$.exports;a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(E)}}).$mount("#app")},6:function(t,e){},7262:function(t,e,n){},"8d4b":function(t,e,n){"use strict";var a=n("9b4f"),r=n.n(a);r.a},"9b4f":function(t,e,n){}});
//# sourceMappingURL=app.a93886e7.js.map